 // test 
function start(){

  window.loadScript = function(url, callback) {
    var script = document.createElement("script");
    script.type = "text/javascript";
    // If the browser is Internet Explorer
    if (script.readyState){
      script.onreadystatechange = function() {
        if (script.readyState == "loaded" || script.readyState == "complete") {
          script.onreadystatechange = null;
          callback();
        }
      };
      // For any other browser
    } else {
      script.onload = function() {
        callback();
      };
    }
    script.src = url;
    document.getElementsByTagName("head")[0].appendChild(script);
  };

  window.checkAppInstalled = function(version) {
    window.soundwaveapps.is_product_option = true
    //loadScript(window.soundwaveapps.po_url+'/intl-tel-input.js', function() {
      commonJS(version);
      cartPageJS(version);
      productPageJS(version);
    //});
  };

  window.commonJS = function($){
    window.soundwaveappsDoActions = function(data) {
      if(data.discounts.discount_show){
        $(".discount_code_box").css("display","block");
      }

      if(data.discounts.plan){
        $(".edit_cart_option").css("display","block");
      }

      if (typeof data.discounts == "object" && typeof data.discounts.cart == "object" && typeof data.discounts.cart.items == "object") {
        soundwaveappsShowCartDiscounts(data.discounts)
      }
      if(data.discounts.is_draft_order){
        $(document).on('click', checkout_selectors, function(e){
          e.preventDefault();
          if (typeof soundwaveappsCheckout != "function") {
            window.location = "/checkout";
          }
          // Order Delivery Date App Code for validation issue. soundwaveappsCheckoutClick() function is at frontend side in theme 
          if(typeof soundwaveappsCheckoutClick === 'undefined'){
              soundwaveappsCheckout();
          }else{
            var result = soundwaveappsCheckoutClick();
            if(result == true){
              soundwaveappsCheckout();
            }else if(result != false){
              soundwaveappsCheckout();
            }
          }
        });
      }
    }
    window.soundwaveappsShowCartDiscounts = function(discounts) {
        window.soundwaveapps.discounts = discounts;
        discounts.cart.items.forEach(function(item) {
          $(".soundwaveapps-cart-item-price[data-key='" + item.key + "']").html("<span class='original_price'>" + item.original_price_format + "</span>");
          $(".soundwaveapps-cart-item-line-price[data-key='" + item.key + "']").html("<span class='original_price'>" + item.original_line_price_format + "</span>")
        });
        if (discounts.discount_code && discounts.discount_error == 1){
          $(".soundwaveapps-cart-original-total").html(discounts.original_price_total);
          jQuery(".soundwaveapps_summary").remove();
          $(".soundwaveapps_discount_hide").after("<span class='soundwaveapps_summary'>Discount code does not match</span>");
          localStorage.removeItem('discount_code');
        }else if (discounts.is_free_shipping){
          jQuery(".soundwaveapps_summary").remove();
          jQuery(".soundwaveapps_discount_hide").after("<span class='soundwaveapps-summary-line-discount-code'><span class='discount-tag'>"+ discounts.discount_code +"<span class='close-tag'></span></span>Free Shipping");
        }else if(discounts.discount_code && $('.discount_code_box').is(":visible")){
          jQuery(".soundwaveapps-summary-line-discount-code,.after_discount_price").remove();
          jQuery(".soundwaveapps_discount_hide").after("<span class='soundwaveapps-summary-line-discount-code'><span class='discount-tag'>"+ discounts.discount_code +"<span class='close-tag'></span></span><span class='soundwaveapps_with_discount'>"+" -" + discounts.with_discount + "</span></span><span class='after_discount_price'><span class='final-total'>Total</span>"+discounts.final_with_discounted_price +"</span>");
          jQuery(".soundwaveapps-cart-original-total").html(discounts.original_price_total)
          if(discounts.original_price_total != discounts.final_with_discounted_price){
            $(".soundwaveapps-cart-original-total").css("text-decoration", "line-through");
          }
          $(".soundwaveapps-cart-total").remove();
        }else{
          $(".soundwaveapps-cart-original-total").html(discounts.original_price_total);
        }
      }
    window.soundwaveappsCheckout = function() {
      var storage_code = localStorage.getItem('discount_code');
      $.getJSON('/cart.js', function(cart) {
        window.soundwaveapps.cart = cart;
        $.ajax({
          type: "POST",
          url: window.soundwaveapps.po_url+"/store/create_draft_order",
          data: {cart_json: window.soundwaveapps,store_id: window.soundwaveapps.store_id, discount_code: storage_code,cart_collections: JSON.stringify(window.soundwaveapps.cart_collections)},
          crossDomain: true,
          success: function(res) {
            if(typeof res == "string"){
              window.location.href = res
            }else{
              window.location.href = "/checkout"
            }
            localStorage.removeItem('discount_code');
          }
        });
      });
      
    }
    window.soundwaveappsStart = function($) {
      window.soundwaveappsc = {};
        window.soundwaveappsc.$first_add_to_cart_el = null;
        var selectors = ["input[name='add']", "button[name='add']", "#add-to-cart", "#AddToCartText", "#AddToCart"];
        var found_selectors = 0;
        selectors.forEach(function(selector) {
          found_selectors += $(selector).length;
          if (window.soundwaveappsc.$first_add_to_cart_el == null && found_selectors) {
            window.soundwaveappsc.$first_add_to_cart_el = $(selector).first()
          }
        });
        /*
        if (window.soundwaveapps.page_type == "product" && window.soundwaveappsc.$first_add_to_cart_el != null) {
          var vol_el_after = window.soundwaveappsc.$first_add_to_cart_el;
          if(vol_el_after.parent().is("div")) {
            vol_el_after = vol_el_after.parent()
          }
          if($('#soundwaveapps_custom_options_'+window.soundwaveapps.product_id).length == 0){
            vol_el_after.before('<div id="soundwaveapps_custom_options_'+window.soundwaveapps.product_id+'"></div>');
          }
        }*/
        if(window.soundwaveapps.page_type == "product"){
          $.ajax({
              type:"GET",
              url: window.soundwaveapps.po_url+"/get-options-by-product-id",
              data : { pid : window.soundwaveapps.product_id,store_id : window.soundwaveapps.store_id},
              sync: false,
              crossDomain: true,
              success:function(response){
                $('#soundwaveapps_custom_options_'+window.soundwaveapps.product_id).html(response);
              }
            });
        }
        if(window.soundwaveapps.page_type == 'cart'){
          $('body').on('click', '.edit_cart_option', function(e) {
            $('body').addClass('body_fixed');
            e.preventDefault();
            var key = $(this).data("key");
            var cart = window.soundwaveapps.cart;
            var store_id = window.soundwaveapps.store_id;
            var pid = $(this).data("product_id");
            var variant_id = $(this).data("variant_id");
            $("[name^='properties']").each(function(){
              if($(this).val() == ''){
                $(this).attr('disabled',true);
              }
            });
            $.ajax({
              type: 'POST',
              url: window.soundwaveapps.po_url+'/api/v2/store/edit_cart',
              data: { cart_data: cart ,item_key: key, store_id: store_id, variant_id: variant_id },
              cache: false,
              crossDomain: true,
              success: function(data){
                if (data == 'ok'){
                  location.reload();
                }else{
                  $('#edit_cart_popup').html(data);
                  $('.edit_popup').show();
                  calc_options_total(pid);
                  conditional_rules(pid);             
                }
              }
            });
          });
        }
        $("body").on("change", 'input[name="updates[]"]', function(ev) {
          $('[name="update"]').click()
        });

      if(window.soundwaveapps.page_type == "cart"){
        var storage_code = localStorage.getItem('discount_code');
        if (storage_code != ''){
          $('.soundwaveapps_discount_code').val(storage_code);
          var get_cart_data = {cart_data: window.soundwaveapps,store_id: window.soundwaveapps.store_id, discount_code: storage_code, cart_collections: JSON.stringify(window.soundwaveapps.cart_collections)}
        }else{
          var get_cart_data = {cart_data: window.soundwaveapps,store_id: window.soundwaveapps.store_id}
        }
        var count=0
        window.soundwaveapps.cart.items.forEach(function(selector) {
         if(selector['properties'] != null && selector['properties'] != {})
          count ++
        });
        if(count > 1)
          $(checkout_selectors).attr('disabled', true);
        else
          $(checkout_selectors).attr('disabled', false);
          
        $(checkout_selectors).attr('disabled', true);
        $.ajax({
          type: "POST",
          url: window.soundwaveapps.po_url+"/store/get_cart_details",
          data: get_cart_data,
          crossDomain: true,
          success: function(data){
            setTimeout(function(){
              $(checkout_selectors).attr('disabled', false);
              soundwaveappsDoActions(data)
            }, 1)
          },
          error: function (request, error) {
              $(checkout_selectors).attr('disabled', false);
          }
        });
      }
    }
    soundwaveappsStart($);
  }


  window.cartPageJS = function($){
    // When user enter the phone_number.
    $(document).on('keypress', '.soundwaveapps_discount_code', function(e){
      if(e.which == 13){
        $(".soundwaveapps_discount_button").click();
      }
      if(e.which === 32){
        return false;
      }
    });

    // Button click for Apply Discount.  
    $(document).on('click', '.soundwaveapps_discount_button', function(e){
      e.preventDefault();
      var code = $('.soundwaveapps_discount_code').val();
      if(code == ''){
        $('.soundwaveapps_discount_code').addClass('discount_error');
      }else{
        localStorage.setItem('discount_code', code);
          $('.soundwaveapps_discount_code').removeClass('discount_error');
          location.reload();
      }
    });

    $(document).on('click', '.close-tag', function(e){
      localStorage.removeItem('discount_code');
      location.reload();
    });

    // When user click on edit_cart save popup.
    $(document).on('click', '.soundwaveapp_save',function(e){
      e.preventDefault();
      if (validate_options($(this).data('product_id'))) {
        $(checkout_selectors).attr('disabled',true);
        var line = parseInt($(this).parents('.soundwaveapp_popupBox').find('.soundwaveapp_mainContent').find('.h_index').val())+1;
        var qty = $(this).attr('data-quantity');
        var line_variant_id = $(this).parents('.soundwaveapp_popupBox').find('.soundwaveapp_mainContent').find('.h_variant_id').val();
        var properties = {};
        
        $("#edit_cart_popup [name^='properties']").each(function (index, el) {
          if ($(this).val() == '') {
            $(this).remove();
          }
          var name;
          if (this.type == "radio") {
            if (this.checked) {
              name = this.name.replace('properties[', '').replace(']', '');
              if ($.trim(this.value).length > 0) {
                properties[name] = this.value;
              }
            }
          }else if(this.type == "file"){
            name = this.name.replace('properties[', '').replace(']', '');
            if ($.trim(this.value).length > 0) {
              properties[name] = this.value;
            }
            
          }else {
            name = this.name.replace('properties[', '').replace(']', '');
            if ($.trim(this.value).length > 0) {
              properties[name] = this.value;
            }
          }
          
        });
        
        if ($.isEmptyObject(properties)) {
          $.ajax({
            type: 'POST',
            url: '/cart/change.js',
            data: {
              quantity: 0,
              line: line
            },
            dataType: 'json',
            success: function(cart) {
              
              if($('.upload_cls').val() != ''){
                $('.upload_h_cls').remove();
              }else{
                $('.upload_cls').remove();
              }
              $('#edit_cart_popup .conditional').each(function(index,element){
                $(this).find('.soundwaveapps_option_value input[type="hidden"]').val('');
              });
              $("[name^='properties']").each(function(index, el) {
                if($(this).val() == ''){
                  $(this).remove();
                }
              });
              $.ajax({
                type: 'POST',
                url: '/cart/add.js',
                data: {
                  quantity: qty,
                  id: line_variant_id
                },
                dataType: 'json',
                success: function (cart_item) {
                  location.reload();                  
                }
              });
            }
          });
        } else { 
          var formData = new FormData($('#edit_cart_popup')[0]);
          formData.append('quantity', qty);
          formData.append('line', line);
          $.ajax({
            type: 'POST',
            url: '/cart/change.js',
            data: {
              quantity: 0,
              line: line
            },
            dataType: 'json',
            success: function(cart) {
              if($('.upload_cls').val() != ''){
                $('.upload_h_cls').remove();
              }else{
                $('.upload_cls').remove();
              }
              $('#edit_cart_popup .conditional').each(function(index,element){
                $(this).find('.soundwaveapps_option_value input[type="hidden"]').val('');
              });
              $("[name^='properties']").each(function(index, el) {
                if($(this).val() == ''){
                  $(this).remove();
                }
              });
              
              $.ajax({
                type: 'POST',
                url: '/cart/add.js',
                data: formData,
                dataType: 'json',
                contentType: false,
                processData: false,
                success: function (cart_item) {
                  location.reload();                  
                }
              });
            }
          });
        }
      };
    });

    // When edit_cart popup is close.
    $(document).on('click touchstart', '.soundwaveapp_close', function(e) {
      $('.edit_popup').hide();
      $('body').removeClass('body_fixed');
    });
  }

  window.productPageJS = function($){
    window.conditional_rules = function(prod_id) {
      pass=false;
      verify_all = Array();
      verify_any = Array();
      verified_condition = Array();
      pass_array = Array();
      $("#soundwaveapps_option_list_" + prod_id + " .condition_hide").removeClass("conditional");
      $("#soundwaveapps_option_list_" + prod_id + " .condition_show").addClass("conditional");
      $("#soundwaveapps_custom_options_" + prod_id + " #conditional_rules").children().each(function() {


        pass_array = Array();
        pass=false;
        $(this).children().each(function() {
          pass=false;
          var condition_rule = $(this).text();
          var field_value;
          if ($(".option_type_id_" + $(this).attr("data-field-num")).hasClass("dd_multi_render") == true) {
            var aa = condition_rule; 
            if (aa.indexOf("!=") >= 0){pass=true;}
            var count = $(".soundwaveapps_option_" + $(this).attr("data-field-num") + "_visible:visible :selected").length;
            var ct=1;
            var selected_array = Array();
            if($(".soundwaveapps_option_" + $(this).attr("data-field-num") + "_visible:visible :selected").length > 0){
              $(".soundwaveapps_option_" + $(this).attr("data-field-num") + "_visible:visible :selected").each(function(){
                var condition_rule=aa;  
                field_value = $(this).data("conditional-value");
                condition_rule = condition_rule.replace("**value11**", field_value);
                if (condition_rule.indexOf("==") >= 0){
                  var condition_rule = condition_rule.split("==");
                  if (condition_rule[0] == condition_rule[1]) {
                    pass = true;
                  } else {
                    pass = false;
                  }
                }
                else{
                  var condition_rule = condition_rule.split("!=");
                  if (condition_rule[0] != condition_rule[1]) {
                    pass = true;
                  } else {
                    pass = false;
                  }
                }
                selected_array.push(pass);
                if(ct==count && count>1){
                  var result = selected_array.join(' || ');
                  result = eval(result);
                  pass_array.push(result);
                }
                else if(count==1){
                  pass_array.push(pass);
                }
                ct=ct+1;
              });
            }else{
              pass_array.push(false);
            }
          }
          else if ($(".option_type_id_" + $(this).attr("data-field-num")).hasClass("cb_render") == true) {
            var aa = condition_rule;
            if (aa.indexOf("!=") >= 0){pass=true;}
            var ctt=1;
            var checked_array = Array();
            var countt = $(".soundwaveapps_option_" + $(this).attr("data-field-num") + "_visible:visible:checked").length;
            $(".soundwaveapps_option_" + $(this).attr("data-field-num") + "_visible:visible:checked").each(function() {
              var condition_rule = aa;
              field_value = $(this).data("conditional-value");
              condition_rule = condition_rule.replace("**value11**", field_value);
              if (condition_rule.indexOf("==") >= 0){
                var condition_rule = condition_rule.split("==");
                if (condition_rule[0] == condition_rule[1]) {
                  pass = true;
                }else{
                  pass = false;
                }
              }
              else{
                var condition_rule = condition_rule.split("!=");
                if (condition_rule[0] != condition_rule[1]) {
                  pass = true;
                }else{
                  pass = false;
                }
              } 
              checked_array.push(pass);
              if(ctt==countt && countt>1){
                var result = checked_array.join(' || ');
                result = eval(result);
                pass_array.push(result);
              }
              else if(countt==1){
                pass_array.push(pass);
              }
              ctt=ctt+1;
            });
          }
          else if ($("#soundwaveapps_option_list_" + prod_id + " .option_type_id_" + $(this).attr("data-field-num")).hasClass("multiswatch_render") == true) {
            var aa = condition_rule;
            if (aa.indexOf("!=") >= 0){pass=true;}
            var ctt=1;
            var checked_array = Array();
            var countt = $("#soundwaveapps_option_list_" + prod_id + " .soundwaveapps_option_" + $(this).attr("data-field-num") + "_visible:checked").length;
            $("#soundwaveapps_option_list_" + prod_id + " .soundwaveapps_option_" + $(this).attr("data-field-num") + "_visible:checked").each(function() {
              var condition_rule = aa;
              field_value = $(this).data("conditional-value");
              condition_rule = condition_rule.replace("**value11**", field_value);
              if (condition_rule.indexOf("==") >= 0){
                var condition_rule = condition_rule.split("==");
                if (condition_rule[0] == condition_rule[1]) {
                  pass = true;
                }else{
                  pass = false;
                }
              }
              else{
                var condition_rule = condition_rule.split("!=");
                if (condition_rule[0] != condition_rule[1]) {
                  pass = true;
                }else{
                  pass = false;
                }
              } 
              checked_array.push(pass);
              if(ctt==countt && countt>1){
                var result = checked_array.join(' || ');
                result = eval(result);
                pass_array.push(result);
              }
              else if(countt==1){
                pass_array.push(pass);
              }
              ctt=ctt+1;
            });
          }  
          else {
            pass=false;
            if ($(".option_type_id_" + $(this).attr("data-field-num")).hasClass("dd_render") == true) {
              field_value = $("#" + $(this).attr("data-field-num") + " option:selected").attr("data-conditional-value");
            } 
            else if ($(".option_type_id_" + $(this).attr("data-field-num")).hasClass("rb_render") == true) {
              field_value = $(".soundwaveapps_option_" + $(this).attr("data-field-num") + ":checked").data("conditional-value");
            }
            else if ($(".option_type_id_" + $(this).attr("data-field-num")).hasClass("swatch_render") == true) {
              field_value = $(".soundwaveapps_option_" + $(this).attr("data-field-num")+ ".swatch_selected").data("conditional-value");
            }else{
              field_value = $("#" + $(this).attr("data-field-num") + "").val();
            }
            condition_rule = condition_rule.replace("**value11**", field_value);
            if (condition_rule.indexOf("==") >= 0){
              var condition_rule = condition_rule.split("==");
              if (condition_rule[0] == condition_rule[1]) {
                pass = true;
              }else{
                pass = false;
              }
            }else{
              var condition_rule = condition_rule.split("!=");
              if (condition_rule[0] != condition_rule[1]) {
                pass = true;
              }else{
                pass = false;
              }
            }
            pass_array.push(pass);
          }
        });

        var type_rule = $(this).attr("data-verify-all");
        var condition_id = $(this).attr("name");
        if(type_rule=="0"){
          var res = pass_array.join(' || ');
        }
        else{
          var res = pass_array.join(' && ');
        }
        res = eval(res);
        if(res){
          $("." + condition_id + "_show").removeClass("conditional");
          $("." + condition_id + "_hide").addClass("conditional");
          $("." + condition_id + "_hide.conditional").find('.soundwaveapps_option_child').each(function() {
            conditional_change($(this));
          });
        }
        else{
          $("." + condition_id + "_show.conditional").find('.soundwaveapps_option_child').each(function() {
            conditional_change($(this));
          });
        }
      });
      calc_options_total(prod_id);
      // border_bottom = $(".soundwaveapps_option:visible").css("border-bottom");
      // $(".soundwaveapps_option:visible").css("border-bottom",border_bottom);
      // $(".soundwaveapps_option:visible:last").css("border-bottom","none");
    }
    window.conditional_change = function(obj){
      if (obj.prop("type") == "select-one" || obj.prop("type") == "select-multiple") {
        if (obj.val()){
          obj.val('');
          obj.parent().removeClass("selected");
        }
      }
      else if (obj.prop("type") == "radio") {
        if (obj.prop("checked")){
          obj.prop("checked", false);
          obj.val('');
          obj.parent().find('.radio_selected').removeClass("radio_selected");
        }
      }
      else if (obj.prop("type") == "textarea" || obj.prop("type") == "number" || obj.prop("type") == "text" || obj.prop("type") == "hidden" || obj.prop("type") == "file" || obj.prop("type") == "email" || obj.prop("type") == "date_picker"){
        if (obj.val()){
          obj.val('').change();
          obj.parents('.soundwaveapps_option_value').find('.tb_property_val').val('');
          obj.parents('.soundwaveapps_option_value').find('#valid-msg').remove();
        }
      }
      else if (obj.prop("type") == "checkbox") {
        if (obj.prop("checked")){
          obj.prop("checked", false);
          obj.parent().removeClass("swatch_selected");
        }
      }
      else if (obj.prop("tagName") == "DIV") {
        if (obj.find('.swatch_radio').prop("checked")){
          obj.find('.swatch_radio').prop("checked", false);
          obj.removeClass("swatch_selected");
        }
      }
    }
    window.calc_options_total = function(product_id) {

      var i;
      var total = 0;
      var format = window.soundwaveapps.money_format;

      checked_variant = $("#soundwaveapps_option_list_" + product_id + ":visible .price-change:checked, #soundwaveapps_option_list_" + product_id + ":visible .price-change:selected, .soundwaveapps_swatch_option .swatch_selected,.textarea_selected,.textbox_selected,.emailbox_selected,.datepicker_selected,.numberfield_selected");
      for (i = 0; i < checked_variant.length; i++) {
        if(!$(checked_variant[i]).parents(".soundwaveapps_option").hasClass('conditional')){
          total = Number($(checked_variant[i]).attr("data-price")) + Number(total);
        }
      }
      $("#soundwaveapps_options_" + product_id + " #raw_option_total").val(total);
      $("#soundwaveapps_options_" + product_id + " #calculated_option_total").html(total.toFixed(2));
      if (total > 0 && 1) {
        $('#soundwaveapps_options_' + product_id + ' #option_total').slideDown();
      }else{
        $('#soundwaveapps_options_' + product_id + ' #option_total').slideUp();
      }
    }
    window.check_character_limit = function(chartotal,product_id,remain_char_msg) {
      var text_length = $('.soundwaveapps_option_value .soundwaveapps_option_'+product_id+'').val().length;
      var text_remaining = chartotal - text_length;
      $('#char_count_'+product_id+'').html(text_remaining + ' ' + remain_char_msg);
    }        
    window.validate_options = function(product_id) {
      var good = true;
     
      $(".soundwaveapps_option:visible").each(function() {
        if ($(this).hasClass("validation_error")) {
          good=false;
        }
      });
      $('#soundwaveapps_options_' + product_id + ' #error_text').html('');
      var soundwaveapps_req = $("#soundwaveapps_option_list_" + product_id + ":visible .required:visible");
      var i;
      for (i = 0; i < soundwaveapps_req.length; i++) {
        if ($(soundwaveapps_req[i]).find("select[name^='properties']").length == 1 && !$(soundwaveapps_req[i]).find("select[name^='properties']").val()) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).find(".soundwaveapps_radio_option").length && !$(soundwaveapps_req[i]).find("input[name^='properties']:checked").length) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        }
        else if ($(soundwaveapps_req[i]).find(".soundwaveapps_swatch_option").length && !$(soundwaveapps_req[i]).find("input[name^='properties']:checked").length) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).find("input[type='text']").length > 1) {
          $(soundwaveapps_req[i]).find("input[type='text']").each(function(){
            if($(this).val() == ''){
              $(soundwaveapps_req[i]).addClass("validation_error");  
              good = false;
            }
          });
        } else if ($(soundwaveapps_req[i]).find("input[type='text']").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").val()) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        }
        else if ($(soundwaveapps_req[i]).find("input[type='email']").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").val()){
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).find(".soundwaveapps_check_option").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").val()) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).find("input[type='file']").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").val()) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).hasClass("cb_render") && $(soundwaveapps_req[i]).find("input[type='checkbox']:checked").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").length) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).hasClass("multiswatch_render") && $(soundwaveapps_req[i]).find("input[type='checkbox']:checked").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").length) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).find("textarea").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").val()) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).find("select[multiple]").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").val()) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else if ($(soundwaveapps_req[i]).find("input[type='number']").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").val()) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;

        } else if ($(soundwaveapps_req[i]).hasClass("dp_render") && $(soundwaveapps_req[i]).find("input[type='text']").length && !$(soundwaveapps_req[i]).find("input[name^='properties']").val()) {
          $(soundwaveapps_req[i]).addClass("validation_error");
          good = false;
        } else {
          $(soundwaveapps_req[i]).removeClass("validation_error");
        }

      }

      $("#soundwaveapps_option_list_" + product_id + " .cb_render:visible").each(function(){
        if($(this).hasClass('required')){
          if ($(this).find("input[type='checkbox']").length){
            if ($(this).find("input[name^='properties']").val()){
              if ($(this).find('.error_span').length > 0){
                $(this).addClass("validation_error");
                good=false;
              }else{
                $(this).removeClass("validation_error");
              }
            }else{
              $(this).addClass("validation_error");
              good=false;
            }
          }else{
            if ($(this).find('.error_span').length > 0){
              $(this).addClass("validation_error");
              good=false;
            }else{
              $(this).removeClass("validation_error");
            }
          }
        }else{
          if ($(this).find('.error_span').length > 0){
            $(this).addClass("validation_error");
            good=false;
          }else{
            $(this).removeClass("validation_error");
          }
        }
      });
      $("#soundwaveapps_option_list_" + product_id + " .multiswatch_render:visible").each(function(){
        if($(this).hasClass('required')){
          if ($(this).find("input[type='checkbox']").length){
            if ($(this).find("input[name^='properties']").val()){
              if ($(this).find('.error_span').length > 0){
                $(this).addClass("validation_error");
                good=false;
              }else{
                $(this).removeClass("validation_error");
              }
            }else{
              $(this).addClass("validation_error");
              good=false;
            }
          }else{
            if ($(this).find('.error_span').length > 0){
              $(this).addClass("validation_error");
              good=false;
            }else{
              $(this).removeClass("validation_error");
            }
          }
        }else{
          if ($(this).find('.error_span').length > 0){
            $(this).addClass("validation_error");
            good=false;
          }else{
            $(this).removeClass("validation_error");
          }
        }
      });

      $("#soundwaveapps_option_list_" + product_id+ " .dd_multi_render:visible").each(function(){
        if($(this).hasClass('required')){
          if ($(this).find("select[multiple]").length){
            if ($(this).find("input[name^='properties']").val()){
              if ($(this).find('.error_span').length > 0){
                $(this).addClass("validation_error");
                good=false;
              }else{
                $(this).removeClass("validation_error");
              }
            }else{
              $(this).addClass("validation_error");
              good=false;
            }
          }else{
            if ($(this).find('.error_span').length > 0){
              $(this).addClass("validation_error");
              good=false;
            }else{
              $(this).removeClass("validation_error");
            }
          }
        }else{
          if ($(this).find('.error_span').length > 0){
            $(this).addClass("validation_error");
            good=false;
          }else{
            $(this).removeClass("validation_error");
          }
        }
      });
      $("#soundwaveapps_option_list_" + product_id + " .et_render.required:visible").each(function(){
        if ($(this).find("input[type='email']").length && ((!$(this).find("input[name^='properties']").val() && $(this).hasClass('required')) || (($(this).find("input[type='email']").val()) != ''))){
          var userEmail = $(this).find("input[type='email']").val();
          var filter = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
          if (!filter.test(userEmail)) {
            $(this).addClass("validation_error");
            good=false;
          }
          else {
            $(this).removeClass("validation_error");
          }
        }
      });
      $("#soundwaveapps_option_list_" + product_id + " .pn_render.required:visible").each(function(){
        if($(this).find("input[type='textbox']").length && ((!$(this).find("input[name^='properties']").val() && $(this).hasClass('required')))){
          $(this).addClass("validation_error");
          good=false;
        }else{
          if($(this).find(".phone_number").hasClass('error')){
            $(this).addClass("validation_error");
            good=false;
          }else{
            $(this).removeClass("validation_error");
          }
        }
      });
      $("#soundwaveapps_option_list_" + product_id + " .dp_render:visible").each(function(){
        if ($(this).find('.error_span').length > 0){
            $(this).addClass("validation_error");
            good=false;
        }else{
            $(this).removeClass("validation_error");
        }
      });
      $("#soundwaveapps_option_list_" + product_id + " .dp_render.required:visible").each(function(){
        if($(this).find("input[type='text']").length && ((!$(this).find("input[name^='properties']").val() && $(this).hasClass('required')))){
          $(this).addClass("validation_error");
          good=false;
        }else{
          if($(this).find('.error_span').length > 0){
            $(this).addClass("validation_error");
            good=false;
          }else{
            $(this).removeClass("validation_error");
          }
        }
      });
      return good;
    }


    window.validate_single_option = function(option_type_id,option_type) {
      if(option_type == 'dd_render'){
        if ($('.'+option_type_id).find("select[name^='properties']").length == 1 && !$('.'+option_type_id).find("select[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
          $('.'+option_type_id).addClass("validation_error");
        }else{
          $('.'+option_type_id).removeClass("validation_error");
        }
      }

      else if(option_type == 'dd_multi_render'){
        if ($('.'+option_type_id).find("select[multiple]").length && !$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
          $('.'+option_type_id).addClass("validation_error");
        }else{
          $('.'+option_type_id).removeClass("validation_error");
        }
      }

      else if(option_type == 'swatch_render'){
        // if ($('.'+option_type_id).find(".soundwaveapps_swatch_option").length && !$('.'+option_type_id).find("input[name^='properties']:checked").length && $('.'+option_type_id).hasClass('required')) {
        //   $('.'+option_type_id).addClass("validation_error");
        // }else {
          $('.'+option_type_id).removeClass("validation_error");
        // }
      }
      else if(option_type == 'multiswatch_render'){
        if ($('.'+option_type_id).find(".soundwaveapps_swatch_option").length && !$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
          $('.'+option_type_id).addClass("validation_error");
        }else {
          $('.'+option_type_id).removeClass("validation_error");
        }
      }

      else if(option_type == 'cb_render'){
        if ($('.'+option_type_id).find(".soundwaveapps_check_option").length && !$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
          $('.'+option_type_id).addClass("validation_error");
        }else {
          $('.'+option_type_id).removeClass("validation_error");
        }
      }

      else if(option_type == 'tb_render'){
        if ($('.'+option_type_id).find("input[type='text']").length && !$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
          $('.'+option_type_id).addClass("validation_error");
        }else {
          $('.'+option_type_id).removeClass("validation_error");
        }
      }
      else if(option_type == 'nf_render'){
        if ($('.'+option_type_id).find("input[type='number']").length && !$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
          $('.'+option_type_id).addClass("validation_error");
        }else {
          $('.'+option_type_id).removeClass("validation_error");
        }
      }
      else if(option_type == 'dp_render'){
        if ($('.'+option_type_id).find("input[type='text']").length && $('.'+option_type_id).find("input[name^='properties']").val()){
          var rxDatePattern = /^(\d{1,2})(\/|-)(\d{1,2})(\/|-)(\d{4})$/; //Declare Regex
          var dtArray = $('.'+option_type_id).find("input[type='text']").val().match(rxDatePattern);    // is format OK?
          if (dtArray == null){
            $('.'+option_type_id).addClass("validation_error");
            $('.'+option_type_id).find('.validation_error').remove();
            $('.'+option_type_id).find("input[type='text']").after('<span class="validation_error error_span">Enter valid date format mm/dd/yyyy</span>');
          }else{ 
            //Checks for mm/dd/yyyy format.
            dtMonth = dtArray[1];
            dtDay= dtArray[3];
            dtYear = dtArray[5]; 
            if (dtMonth < 1 || dtMonth > 12){
              $('.'+option_type_id).addClass("validation_error");
              $('.'+option_type_id).find('.validation_error').remove();
              $('.'+option_type_id).find("input[type='text']").after('<span class="validation_error error_span">Enter valid date format mm/dd/yyyy</span>')
            }else if (dtDay < 1 || dtDay> 31){ 
              $('.'+option_type_id).addClass("validation_error");
              $('.'+option_type_id).find('.validation_error').remove();
              $('.'+option_type_id).find("input[type='text']").after('<span class="validation_error error_span">Enter valid date format mm/dd/yyyy</span>')
            }else if ((dtMonth==4 || dtMonth==6 || dtMonth==9 || dtMonth==11) && dtDay ==31){
              $('.'+option_type_id).addClass("validation_error");
              $('.'+option_type_id).find('.validation_error').remove();
              $('.'+option_type_id).find("input[type='text']").after('<span class="validation_error error_span">Enter valid date format mm/dd/yyyy</span>')
            }else if (dtMonth == 2){
              var isleap = (dtYear % 4 == 0 && (dtYear % 100 != 0 || dtYear % 400 == 0));
              if (dtDay> 29 || (dtDay ==29 && !isleap)){
                $('.'+option_type_id).addClass("validation_error");
                $('.'+option_type_id).find('.validation_error').remove();
                $('.'+option_type_id).find("input[type='text']").after('<span class="validation_error error_span">Enter valid date format mm/dd/yyyy</span>')
              }else{
                $('.'+option_type_id).removeClass("validation_error");
                $('.'+option_type_id).find('.validation_error').remove();
              }
            }else if (dtArray[2] !== "/" || dtArray[4] !== "/"){
                $('.'+option_type_id).addClass("validation_error");
                $('.'+option_type_id).find('.validation_error').remove();
                $('.'+option_type_id).find("input[type='text']").after('<span class="validation_error error_span">Enter valid date format mm/dd/yyyy</span>')
            }else{
              $('.'+option_type_id).removeClass("validation_error");
              $('.'+option_type_id).find('.validation_error').remove();
            }
          }
        }else{
          if ($('.'+option_type_id).find("input[type='text']").length && !$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
            $('.'+option_type_id).addClass("validation_error");
            $('.'+option_type_id).find('.validation_error').remove();
          }
          else {
            $('.'+option_type_id).find('.validation_error').remove();
            $('.'+option_type_id).removeClass("validation_error");
          }
        }
      }
      else if(option_type == 'ta_render'){
        if ($('.'+option_type_id).find("textarea").length && !$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
          $('.'+option_type_id).addClass("validation_error");
        }else {
          $('.'+option_type_id).removeClass("validation_error");
        }
      }

      else if(option_type == 'rb_render'){
        // if ($('.'+option_type_id).find(".soundwaveapps_radio_option").length && !$('.'+option_type_id).find("input[name^='properties']:checked").length && $('.'+option_type_id).hasClass('required')) {
        //   $('.'+option_type_id).addClass("validation_error");
        // }else {
          $('.'+option_type_id).removeClass("validation_error");
        // }
      }

      else if(option_type == 'fu_render'){
        if ($('.'+option_type_id).find("input[type='file']").length && !$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) {
          $('.'+option_type_id).addClass("validation_error");
        }else {
          $('.'+option_type_id).removeClass("validation_error");
        }
      }

      else if(option_type == 'pn_render'){
        if($('.'+option_type_id).find("input[type='textbox']").length && ((!$('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')))){
          $('.'+option_type_id).addClass("validation_error");
          good=false;
        }else{
          if($('.'+option_type_id).find(".phone_number").hasClass('error')){
            $('.'+option_type_id).addClass("validation_error");
            good=false;
          }else{
            $('.'+option_type_id).removeClass("validation_error");
          }
        }
      }

      else if(option_type == 'et_render'){
        if ($('.'+option_type_id).find("input[type='email']").length && (($('.'+option_type_id).find("input[name^='properties']").val() && $('.'+option_type_id).hasClass('required')) || (($('.'+option_type_id).find("input[type='email']").val().length) != ''))){
          var userEmail = $('.'+option_type_id).find("input[type='email']").val();
          var filter = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
          if (!filter.test(userEmail)) {
            $('.'+option_type_id).addClass("validation_error");
          }else{
            $('.'+option_type_id).removeClass("validation_error");
          }
        }else{
          $('.'+option_type_id).removeClass("validation_error");
        }
      }
    }
  
    var soundwave_flag = 0;
    $(document).on('click', '.soundwaveapps_submit_cart', function(e) {
      if(soundwave_flag == 0){
        e.preventDefault();
        var res = true;

        if (validate_options(window.soundwaveapps.product_id)) {
          $("[name^='properties']").each(function(){
            if($(this).val() == ''){
              $(this).attr('disabled',true);
            }
          });
          soundwave_flag = 1;
          $('.soundwaveapps_submit_cart').click();
        }
      };
    });
  }
}

start();
if (typeof window.soundwaveapps !== 'undefined'){
  if ((typeof(jQuery) == 'undefined') || (parseInt(jQuery.fn.jquery) == 3 && parseFloat(jQuery.fn.jquery.replace(/^1\./,"")) < 2.1)) {
    loadScript('//ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js', function() {
      jQuery321 = jQuery.noConflict(true);
      checkAppInstalled(jQuery321);
    });
  }else{  
    checkAppInstalled(jQuery);
  }
}